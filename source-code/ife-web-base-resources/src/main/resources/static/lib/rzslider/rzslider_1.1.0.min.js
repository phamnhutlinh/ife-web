(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(["angular"],factory)}else if(typeof module==="object"&&module.exports){module.exports=factory(require("angular"))}else{factory(root.angular)}})(this,function(angular){"use strict";var module=angular.module("rzModule",["filterUIModule"]).value("throttle",function throttle(func,wait,options){"use strict";var getTime=Date.now||function(){return(new Date).getTime()};var context,args,result;var timeout=null;var previous=0;options=options||{};var later=function(){previous=options.leading===false?0:getTime();timeout=null;result=func.apply(context,args);context=args=null};return function(){var now=getTime();if(!previous&&options.leading===false){previous=now}var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args);context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}}).factory("RzSlider",["$timeout","$document","$window","throttle","$filter",function($timeout,$document,$window,throttle,$filter){"use strict";var Slider=function(scope,sliderElem,attributes){this.scope=scope;this.attributes=attributes;this.sliderElem=sliderElem;this.range=attributes.rzSliderHigh!==undefined&&attributes.rzSliderModel!==undefined;this.dragRange=this.range&&attributes.rzSliderDraggableRange==="true";this.dragging={active:false,value:0,difference:0,offset:0,lowDist:0,highDist:0};this.handleHalfWidth=0;this.alwaysShowBar=!!attributes.rzSliderAlwaysShowBar;this.maxLeft=0;this.precision=0;this.step=0;this.tracking="";this.minValue=0;this.maxValue=0;this.hideLimitLabels=!!attributes.rzSliderHideLimitLabels;this.presentOnly=attributes.rzSliderPresentOnly==="true";this.showTicks=attributes.rzSliderShowTicks||attributes.rzSliderShowTicksValue;this.showTicksValue=attributes.rzSliderShowTicksValue;this.disabled=this.scope.rzSliderDisabled;this.interval=this.scope.rzSliderInterval!==null?this.scope.rzSliderInterval:350;this.valueRange=0;this.initHasRun=false;this.customTrFn=this.scope.rzSliderTranslate()||function(value){return String(value)};this.deRegFuncs=[];this.fullBar=null;this.selBar=null;this.minH=null;this.maxH=null;this.flrLab=null;this.ceilLab=null;this.minLab=null;this.maxLab=null;this.cmbLab=null;this.ticks=null;this.init()};Slider.prototype={init:function(){var thrLow,thrHigh,unRegFn,calcDimFn=angular.bind(this,this.calcViewDimensions),self=this;this.initElemHandles();this.addAccessibility();this.setDisabledState();this.calcViewDimensions();this.setMinAndMax();this.precision=this.scope.rzSliderPrecision===undefined?0:+this.scope.rzSliderPrecision;this.step=this.scope.rzSliderStep===undefined?1:+this.scope.rzSliderStep;$timeout(function(){self.updateCeilLab();self.updateFloorLab();self.initHandles();self.bindEvents()});unRegFn=this.scope.$on("reCalcViewDimensions",calcDimFn);this.deRegFuncs.push(unRegFn);angular.element($window).on("resize",calcDimFn);this.initHasRun=true;thrLow=throttle(function(){self.setMinAndMax();self.updateLowHandle(self.valueToOffset(self.scope.rzSliderModel));self.updateSelectionBar();self.updateTicksScale();if(self.range){self.updateCmbLabel()}},self.interval);thrHigh=throttle(function(){self.setMinAndMax();self.updateHighHandle(self.valueToOffset(self.scope.rzSliderHigh));self.updateSelectionBar();self.updateTicksScale();self.updateCmbLabel()},self.interval);this.scope.$on("rzSliderForceRender",function(){self.resetLabelsValue();thrLow();if(self.range){thrHigh()}self.resetSlider()});unRegFn=this.scope.$watch("rzSliderModel",function(newValue,oldValue){if(newValue===oldValue){return}thrLow()});this.deRegFuncs.push(unRegFn);unRegFn=this.scope.$watch("rzSliderHigh",function(newValue,oldValue){if(newValue===oldValue){return}thrHigh()});this.deRegFuncs.push(unRegFn);this.scope.$watch("rzSliderFloor",function(newValue,oldValue){if(newValue===oldValue){return}self.resetSlider()});this.deRegFuncs.push(unRegFn);unRegFn=this.scope.$watch("rzSliderCeil",function(newValue,oldValue){if(newValue===oldValue){return}self.resetSlider()});this.deRegFuncs.push(unRegFn);unRegFn=this.scope.$watch("rzSliderShowTicks",function(newValue,oldValue){if(newValue===oldValue){return}self.resetSlider()});this.deRegFuncs.push(unRegFn);unRegFn=this.scope.$watch("rzSliderShowTicksValue",function(newValue,oldValue){if(newValue===oldValue){return}self.resetSlider()});this.deRegFuncs.push(unRegFn);unRegFn=this.scope.$watch("rzSliderDisabled",function(newValue,oldValue){if(newValue===oldValue){return}self.resetSlider();if(self.disabled)self.unbindEvents();else self.bindEvents()});this.deRegFuncs.push(unRegFn);this.scope.$on("$destroy",function(){self.unbindEvents();angular.element($window).off("resize",calcDimFn);self.deRegFuncs.map(function(unbind){unbind()})})},resetSlider:function(){this.setMinAndMax();this.updateCeilLab();this.updateFloorLab();this.setDisabledState();this.calcViewDimensions()},setDisabledState:function(){this.disabled=this.scope.rzSliderDisabled;if(this.disabled){this.sliderElem.attr("disabled","disabled")}else{this.sliderElem.attr("disabled",null)}},resetLabelsValue:function(){this.minLab.rzsv=undefined;this.maxLab.rzsv=undefined},initHandles:function(){this.updateLowHandle(this.valueToOffset(this.scope.rzSliderModel));if(this.range)this.updateHighHandle(this.valueToOffset(this.scope.rzSliderHigh));this.updateSelectionBar();if(this.range)this.updateCmbLabel();this.updateTicksScale()},translateFn:function(value,label,useCustomTr){useCustomTr=useCustomTr===undefined?true:useCustomTr;var valStr=(useCustomTr?this.customTrFn(value):value).toString(),getWidth=false;if(label.rzsv===undefined||label.rzsv.length!==valStr.length||label.rzsv.length>0&&label.rzsw===0){getWidth=true;label.rzsv=valStr}if(this.scope.rzSliderFormat=="currency"){var toFix=this.scope.rzSliderPrecision==undefined?0:this.scope.rzSliderPrecision;label.text($filter(this.scope.rzSliderFormat)(valStr,"",toFix))}else{label.text(valStr)}if(getWidth){this.getWidth(label)}},setMinAndMax:function(){if(this.scope.rzSliderFloor){this.minValue=+this.scope.rzSliderFloor}else{this.minValue=this.scope.rzSliderFloor=0}if(this.scope.rzSliderCeil){this.maxValue=+this.scope.rzSliderCeil}else{this.maxValue=this.scope.rzSliderCeil=this.range?this.scope.rzSliderHigh:this.scope.rzSliderModel}if(this.scope.rzSliderStep){this.step=+this.scope.rzSliderStep}this.valueRange=this.maxValue-this.minValue},initElemHandles:function(){angular.forEach(this.sliderElem.children(),function(elem,index){var jElem=angular.element(elem);switch(index){case 0:this.fullBar=jElem;break;case 1:this.selBar=jElem;break;case 2:this.minH=jElem;break;case 3:this.maxH=jElem;break;case 4:this.flrLab=jElem;break;case 5:this.ceilLab=jElem;break;case 6:this.minLab=jElem;break;case 7:this.maxLab=jElem;break;case 8:this.cmbLab=jElem;break;case 9:this.ticks=jElem;break}},this);this.selBar.rzsl=0;this.minH.rzsl=0;this.maxH.rzsl=0;this.flrLab.rzsl=0;this.ceilLab.rzsl=0;this.minLab.rzsl=0;this.maxLab.rzsl=0;this.cmbLab.rzsl=0;if(this.hideLimitLabels){this.flrLab.rzAlwaysHide=true;this.ceilLab.rzAlwaysHide=true;this.hideEl(this.flrLab);this.hideEl(this.ceilLab)}if(this.showTicksValue){this.flrLab.rzAlwaysHide=true;this.ceilLab.rzAlwaysHide=true;this.minLab.rzAlwaysHide=true;this.maxLab.rzAlwaysHide=true;this.cmbLab.rzAlwaysHide=true;this.hideEl(this.flrLab);this.hideEl(this.ceilLab);this.hideEl(this.minLab);this.hideEl(this.maxLab);this.hideEl(this.cmbLab)}if(this.range===false){this.cmbLab.remove();this.maxLab.remove();this.maxH.rzAlwaysHide=true;this.maxH[0].style.zIndex="-1000";this.hideEl(this.maxH)}if(this.range===false&&this.alwaysShowBar===false){this.maxH.remove();this.selBar.remove()}if(this.dragRange){this.selBar.css("cursor","move");this.selBar.addClass("rz-draggable")}},addAccessibility:function(){this.sliderElem.attr("role","slider")},calcViewDimensions:function(){var handleWidth=this.getWidth(this.minH);this.handleHalfWidth=handleWidth/2;this.barWidth=this.getWidth(this.fullBar);this.maxLeft=this.barWidth-handleWidth;this.getWidth(this.sliderElem);this.sliderElem.rzsl=this.sliderElem[0].getBoundingClientRect().left;if(this.initHasRun){this.updateFloorLab();this.updateCeilLab();this.initHandles()}},updateTicksScale:function(){if(!this.showTicks)return;if(!this.step)return;var positions="",ticksCount=Math.round((this.maxValue-this.minValue)/this.step)+1;for(var i=0;i<ticksCount;i++){var value=this.roundStep(this.minValue+i*this.step);var selectedClass=this.isTickSelected(value)?"selected":"";positions+='<li class="tick '+selectedClass+'">';if(this.showTicksValue)positions+='<span class="tick-value">'+this.getDisplayValue(value)+"</span>";positions+="</li>"}this.ticks.html(positions)},isTickSelected:function(value){var tickLeft=this.valueToOffset(value);if(!this.range&&this.alwaysShowBar&&value<=this.scope.rzSliderModel)return true;if(this.range&&value>=this.scope.rzSliderModel&&value<=this.scope.rzSliderHigh)return true;return false},updateCeilLab:function(){this.translateFn(this.scope.rzSliderCeil,this.ceilLab);this.setLeft(this.ceilLab,this.barWidth-this.ceilLab.rzsw);this.getWidth(this.ceilLab)},updateFloorLab:function(){this.translateFn(this.scope.rzSliderFloor,this.flrLab);this.getWidth(this.flrLab)},callOnStart:function(){if(this.scope.rzSliderOnStart){var self=this;$timeout(function(){self.scope.rzSliderOnStart()})}},callOnChange:function(){if(this.scope.rzSliderOnChange){var self=this;$timeout(function(){self.scope.rzSliderOnChange()})}},callOnEnd:function(){if(this.scope.rzSliderOnEnd){var self=this;$timeout(function(){self.scope.rzSliderOnEnd()})}},updateHandles:function(which,newOffset){if(which==="rzSliderModel"){this.updateLowHandle(newOffset);this.updateSelectionBar();this.updateTicksScale();if(this.range){this.updateCmbLabel()}return}if(which==="rzSliderHigh"){this.updateHighHandle(newOffset);this.updateSelectionBar();this.updateTicksScale();if(this.range){this.updateCmbLabel()}return}this.updateLowHandle(newOffset);this.updateHighHandle(newOffset);this.updateSelectionBar();this.updateTicksScale();this.updateCmbLabel()},updateLowHandle:function(newOffset){this.setLeft(this.minH,newOffset);this.translateFn(this.scope.rzSliderModel,this.minLab);this.setLeft(this.minLab,newOffset-this.minLab.rzsw/2+this.handleHalfWidth);this.shFloorCeil()},updateHighHandle:function(newOffset){this.setLeft(this.maxH,newOffset);this.translateFn(this.scope.rzSliderHigh,this.maxLab);this.setLeft(this.maxLab,newOffset-this.maxLab.rzsw/2+this.handleHalfWidth);this.shFloorCeil()},shFloorCeil:function(){var flHidden=false,clHidden=false;if(this.minLab.rzsl<=this.flrLab.rzsl+this.flrLab.rzsw+5){flHidden=true;this.hideEl(this.flrLab)}else{flHidden=false;this.showEl(this.flrLab)}if(this.minLab.rzsl+this.minLab.rzsw>=this.ceilLab.rzsl-this.handleHalfWidth-10){clHidden=true;this.hideEl(this.ceilLab)}else{clHidden=false;this.showEl(this.ceilLab)}if(this.range){if(this.maxLab.rzsl+this.maxLab.rzsw>=this.ceilLab.rzsl-10){this.hideEl(this.ceilLab)}else if(!clHidden){this.showEl(this.ceilLab)}if(this.maxLab.rzsl<=this.flrLab.rzsl+this.flrLab.rzsw+this.handleHalfWidth){this.hideEl(this.flrLab)}else if(!flHidden){this.showEl(this.flrLab)}}},updateSelectionBar:function(){this.setWidth(this.selBar,Math.abs(this.maxH.rzsl-this.minH.rzsl)+this.handleHalfWidth);this.setLeft(this.selBar,this.range?this.minH.rzsl+this.handleHalfWidth:0)},updateCmbLabel:function(){var lowTr,highTr;if(this.minLab.rzsl+this.minLab.rzsw+10>=this.maxLab.rzsl){lowTr=this.getDisplayValue(this.scope.rzSliderModel);highTr=this.getDisplayValue(this.scope.rzSliderHigh);this.translateFn(lowTr+" - "+highTr,this.cmbLab,false);this.setLeft(this.cmbLab,this.selBar.rzsl+this.selBar.rzsw/2-this.cmbLab.rzsw/2);this.hideEl(this.minLab);this.hideEl(this.maxLab);this.showEl(this.cmbLab)}else{this.showEl(this.maxLab);this.showEl(this.minLab);this.hideEl(this.cmbLab)}},getDisplayValue:function(value){return this.customTrFn?this.customTrFn(value):value},roundStep:function(value){var step=this.step,remainder=+((value-this.minValue)%step).toFixed(3),steppedValue=remainder>step/2?value+step-remainder:value-remainder;steppedValue=steppedValue.toFixed(this.precision);return+steppedValue},hideEl:function(element){return element.css({opacity:0})},showEl:function(element){if(!!element.rzAlwaysHide){return element}return element.css({opacity:1})},setLeft:function(elem,left){elem.rzsl=left;elem.css({left:left+"px"});return left},getWidth:function(elem){var val=elem[0].getBoundingClientRect();elem.rzsw=val.right-val.left;return elem.rzsw},setWidth:function(elem,width){elem.rzsw=width;elem.css({width:width+"px"});return width},valueToOffset:function(val){return(val-this.minValue)*this.maxLeft/this.valueRange||0},offsetToValue:function(offset){return offset/this.maxLeft*this.valueRange+this.minValue},getEventX:function(event){if("clientX"in event){return event.clientX}return event.originalEvent===undefined?event.touches[0].clientX:event.originalEvent.touches[0].clientX},getNearestHandle:function(event){if(!this.range){return this.minH}var offset=this.getEventX(event)-this.sliderElem.rzsl-this.handleHalfWidth;return Math.abs(offset-this.minH.rzsl)<Math.abs(offset-this.maxH.rzsl)?this.minH:this.maxH},bindEvents:function(){if(this.presentOnly||this.disabled)return;var barTracking,barStart,barMove;if(this.dragRange){barTracking="rzSliderDrag";barStart=this.onDragStart;barMove=this.onDragMove}else{barTracking="rzSliderModel";barStart=this.onStart;barMove=this.onMove}this.minH.on("mousedown",angular.bind(this,this.onStart,this.minH,"rzSliderModel"));if(this.range){this.maxH.on("mousedown",angular.bind(this,this.onStart,this.maxH,"rzSliderHigh"))}this.fullBar.on("mousedown",angular.bind(this,this.onStart,null,null));this.fullBar.on("mousedown",angular.bind(this,this.onMove,this.fullBar));this.selBar.on("mousedown",angular.bind(this,barStart,null,barTracking));this.selBar.on("mousedown",angular.bind(this,barMove,this.selBar));this.ticks.on("mousedown",angular.bind(this,this.onStart,null,null));this.ticks.on("mousedown",angular.bind(this,this.onMove,this.ticks));this.minH.on("touchstart",angular.bind(this,this.onStart,this.minH,"rzSliderModel"));if(this.range){this.maxH.on("touchstart",angular.bind(this,this.onStart,this.maxH,"rzSliderHigh"))}this.fullBar.on("touchstart",angular.bind(this,this.onStart,null,null));this.fullBar.on("touchstart",angular.bind(this,this.onMove,this.fullBar));this.selBar.on("touchstart",angular.bind(this,barStart,null,barTracking));this.selBar.on("touchstart",angular.bind(this,barMove,this.selBar));this.ticks.on("touchstart",angular.bind(this,this.onStart,null,null));this.ticks.on("touchstart",angular.bind(this,this.onMove,this.ticks))},unbindEvents:function(){this.minH.off();this.maxH.off();this.fullBar.off();this.selBar.off();this.ticks.off()},onStart:function(pointer,ref,event){var ehMove,ehEnd,eventNames=this.getEventNames(event);event.stopPropagation();event.preventDefault();if(this.tracking!==""){return}this.calcViewDimensions();if(pointer){this.tracking=ref}else{pointer=this.getNearestHandle(event);this.tracking=pointer===this.minH?"rzSliderModel":"rzSliderHigh"}pointer.addClass("rz-active");ehMove=angular.bind(this,this.dragging.active?this.onDragMove:this.onMove,pointer);ehEnd=angular.bind(this,this.onEnd,ehMove);$document.on(eventNames.moveEvent,ehMove);$document.one(eventNames.endEvent,ehEnd);this.callOnStart()},onMove:function(pointer,event){var eventX=this.getEventX(event),sliderLO,newOffset,newValue;sliderLO=this.sliderElem.rzsl;newOffset=eventX-sliderLO-this.handleHalfWidth;if(newOffset<=0){if(pointer.rzsl===0)return;newValue=this.minValue;newOffset=0}else if(newOffset>=this.maxLeft){if(pointer.rzsl===this.maxLeft)return;newValue=this.maxValue;newOffset=this.maxLeft}else{newValue=this.offsetToValue(newOffset);newValue=this.roundStep(newValue);newOffset=this.valueToOffset(newValue)}this.positionTrackingHandle(newValue,newOffset)},onDragStart:function(pointer,ref,event){var offset=this.getEventX(event)-this.sliderElem.rzsl-this.handleHalfWidth;this.dragging={active:true,value:this.offsetToValue(offset),difference:this.scope.rzSliderHigh-this.scope.rzSliderModel,offset:offset,lowDist:offset-this.minH.rzsl,highDist:this.maxH.rzsl-offset};this.minH.addClass("rz-active");this.maxH.addClass("rz-active");this.onStart(pointer,ref,event)},onDragMove:function(pointer,event){var newOffset=this.getEventX(event)-this.sliderElem.rzsl-this.handleHalfWidth,newMinOffset,newMaxOffset,newMinValue,newMaxValue;if(newOffset<=this.dragging.lowDist){if(pointer.rzsl===this.dragging.lowDist){return}newMinValue=this.minValue;newMinOffset=0;newMaxValue=this.dragging.difference;newMaxOffset=this.valueToOffset(newMaxValue)}else if(newOffset>=this.maxLeft-this.dragging.highDist){if(pointer.rzsl===this.dragging.highDist){return}newMaxValue=this.maxValue;newMaxOffset=this.maxLeft;newMinValue=this.maxValue-this.dragging.difference;newMinOffset=this.valueToOffset(newMinValue)}else{newMinValue=this.offsetToValue(newOffset-this.dragging.lowDist);newMinValue=this.roundStep(newMinValue);newMinOffset=this.valueToOffset(newMinValue);newMaxValue=newMinValue+this.dragging.difference;newMaxOffset=this.valueToOffset(newMaxValue)}this.positionTrackingBar(newMinValue,newMaxValue,newMinOffset,newMaxOffset)},positionTrackingBar:function(newMinValue,newMaxValue,newMinOffset,newMaxOffset){this.scope.rzSliderModel=newMinValue;this.scope.rzSliderHigh=newMaxValue;this.updateHandles("rzSliderModel",newMinOffset);this.updateHandles("rzSliderHigh",newMaxOffset);this.scope.$apply();this.callOnChange()},positionTrackingHandle:function(newValue,newOffset){if(this.range){if(this.tracking==="rzSliderModel"&&newValue>=this.scope.rzSliderHigh){this.scope[this.tracking]=this.scope.rzSliderHigh;this.updateHandles(this.tracking,this.maxH.rzsl);this.tracking="rzSliderHigh";this.minH.removeClass("rz-active");this.maxH.addClass("rz-active");this.scope.$apply();this.callOnChange()}else if(this.tracking==="rzSliderHigh"&&newValue<=this.scope.rzSliderModel){this.scope[this.tracking]=this.scope.rzSliderModel;this.updateHandles(this.tracking,this.minH.rzsl);this.tracking="rzSliderModel";this.maxH.removeClass("rz-active");this.minH.addClass("rz-active");this.scope.$apply();this.callOnChange()}}if(this.scope[this.tracking]!==newValue){this.scope[this.tracking]=newValue;this.updateHandles(this.tracking,newOffset);this.scope.$apply();this.callOnChange()}},onEnd:function(ehMove,event){var moveEventName=this.getEventNames(event).moveEvent;this.minH.removeClass("rz-active");this.maxH.removeClass("rz-active");$document.off(moveEventName,ehMove);this.scope.$emit("slideEnded");this.tracking="";this.dragging.active=false;this.callOnEnd()},getEventNames:function(event){var eventNames={moveEvent:"",endEvent:""};if(event.touches||event.originalEvent!==undefined&&event.originalEvent.touches){eventNames.moveEvent="touchmove";eventNames.endEvent="touchend"}else{eventNames.moveEvent="mousemove";eventNames.endEvent="mouseup"}return eventNames}};return Slider}]).directive("rzslider",["RzSlider",function(RzSlider){"use strict";return{restrict:"E",scope:{rzSliderFloor:"=?",rzSliderCeil:"=?",rzSliderStep:"@",rzSliderPrecision:"@",rzSliderModel:"=?",rzSliderHigh:"=?",rzSliderDraggable:"@",rzSliderTranslate:"&",rzSliderHideLimitLabels:"=?",rzSliderAlwaysShowBar:"=?",rzSliderPresentOnly:"@",rzSliderOnStart:"&",rzSliderOnChange:"&",rzSliderOnEnd:"&",rzSliderShowTicks:"=?",rzSliderShowTicksValue:"=?",rzSliderDisabled:"=?",rzSliderInterval:"=?",rzSliderFormat:"@"},templateUrl:function(elem,attrs){return attrs.rzSliderTplUrl||"rzSliderTpl.html"},link:function(scope,elem,attr){return new RzSlider(scope,elem,attr)}}}]);module.run(["$templateCache",function($templateCache){"use strict";$templateCache.put("rzSliderTpl.html",'<span class=rz-bar-wrapper><span class=rz-bar></span></span> <span class=rz-bar-wrapper><span class="rz-bar rz-selection"></span></span> <span class=rz-pointer></span> <span class=rz-pointer></span> <span class="rz-bubble rz-limit"></span> <span class="rz-bubble rz-limit"></span> <span class=rz-bubble></span> <span class=rz-bubble></span> <span class=rz-bubble></span><ul class=rz-ticks></ul>')}]);return module});
