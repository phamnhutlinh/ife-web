angular.module("angular-carousel",["ngTouch"]).service("CollectionManager",[function(){function t(t){var e,i={bufferSize:0,bufferStart:0,buffered:!1,cycle:!1,cycleOffset:0,index:0,position:0,items:[],cards:[],updated:null,debug:!1};if(t)for(e in t)i[e]=t[e];for(e in i)this[e]=i[e];angular.extend(this,i,t),this.init()}return t.prototype.log=function(){this.debug&&console.log.apply(console,arguments)},t.prototype.getPositionFromIndex=function(t){return(t+this.cycleOffset)%this.length()},t.prototype.goToIndex=function(t,e){if(t=Math.max(0,Math.min(t,this.getLastIndex())),this.updated&&t===this.index)return this.log("skip position change(same)"),!1;var i=this.getPositionFromIndex(t);return this.goTo(i,e)},t.prototype.goTo=function(t,e){if(this.log("goto start",t,e),0===this.length())return void this.log("empty, skip gotoIndex");t=Math.max(0,Math.min(t,this.getLastIndex()));var i=!1;this.cycle&&(0===t?(this.log("cycleAtBeginning",t),this.cycleAtBeginning(),t=1,this.cycleOffset++,i=!0):t===this.getLastIndex()&&(this.log("cycleAtEnd",t),this.cycleAtEnd(),t--,this.cycleOffset--,i=!0),this.cycleOffset%=this.length()),this.position=Math.max(0,Math.min(t,this.getLastIndex()));var n=(this.position-this.cycleOffset+this.length())%this.length();this.index=Math.max(0,Math.min(n,this.getLastIndex())),e||this.adjustBuffer(),i||(this.updated=new Date)},t.prototype.next=function(){this.goTo(this.cycle?(this.position+1)%this.length():Math.min(this.position+1,this.getLastIndex()))},t.prototype.prev=function(){if(this.cycle)this.goTo((this.position-1+this.length())%this.length());else{var t=this.length()>0?Math.max(0,(this.position-1)%this.length()):0;this.goTo(t)}},t.prototype.setBufferSize=function(t){this.log("setBufferSize",t),this.bufferSize=t,this.adjustBuffer()},t.prototype.isBuffered=function(){return this.buffered},t.prototype.getRelativeIndex=function(){var t=Math.max(0,Math.min(this.getLastIndex(),this.position-this.bufferStart));return t},t.prototype.adjustBuffer=function(){var t=(this.getLastIndex()+1-this.bufferSize)%this.length();this.log("maxBufferStart",t),this.bufferStart=Math.max(0,Math.min(t,this.position-1)),this.cards=this.items.slice(this.bufferStart,this.bufferStart+this.bufferSize),this.log("adjustBuffer from",this.bufferStart,"to",this.bufferStart+this.bufferSize)},t.prototype.length=function(){return this.items.length},t.prototype.getLastIndex=function(){var t=Math.max(0,this.length()-1);return t},t.prototype.init=function(){this.setBufferSize(this.isBuffered()?this.bufferSize:this.length()),this.length()>0&&this.goToIndex(this.index)},t.prototype.setItems=function(t,e){this.log("setItems",t,e),e&&(this.index=0,this.position=0),this.items=t||[],this.init()},t.prototype.cycleAtEnd=function(){this.push(this.items.shift())},t.prototype.push=function(t,e){this.log("push item(s)",t,e),this.items.push(t),e&&(this.adjustBuffer(),this.updated=new Date),this.buffered||this.bufferSize++},t.prototype.unshift=function(t,e){this.log("unshift item(s)",t,e),this.items.unshift(t),this.buffered||this.bufferSize++,e&&(this.position++,this.adjustBuffer(),this.updated=new Date)},t.prototype.cycleAtBeginning=function(){this.unshift(this.items.pop())},{create:function(e){return new t(e)}}}]).directive("rnCarousel",["$compile","$parse","$swipe","$document","$window","CollectionManager",function(t,e,i,n,s,o){var r=0;return{restrict:"A",scope:!0,compile:function(i,n){i.addClass("rn-carousel-slides");var s,a,c=i.children("li")[0].attributes,l=c["ng-repeat"],u=!1;if(l||(l=c["data-ng-repeat"]),l||(l=c["x-ng-repeat"]),l){var h=l.value.match(/^\s*(.+)\s+in\s+(.*?)\s*(\s+track\s+by\s+(.+)\s*)?$/),f=h[1],d=h[3]||"";s=h[2],u=angular.isDefined(n.rnCarouselBuffered),l.value=f+" in carouselCollection.cards "+d}else{var p=i.children("li");if(p.length<2)throw new Error("carousel: cannot find the ngRepeat attribute OR no childNodes detected");s="fakeArray",a=Array.prototype.slice.apply(p)}return function(i,n,c){function l(t){var e=angular.element(t).css("transform").match(/translate3d\((-?\d+(?:px)?),\s*(-?\d+(?:px)?),\s*(-?\d+(?:px)?)\)/);return e?e.slice(1,3):[0,0,0]}function h(t){!t.target||t.target!==S[0]||"transform"!==t.propertyName&&"-webkit-transform"!==t.propertyName&&"-moz-transform"!==t.propertyName||(i.$apply(function(){p(),i.carouselCollection.adjustBuffer(),v(!0)}),S.css(m(l(S[0]),!0)))}function f(t,e){function n(){w=!0,i.carouselCollection[t](e,!0)}i.$$phase?n():i.$apply(n)}function d(t,e){var i="after"===t?"push":"unshift";e&&(angular.isObject(e.promise)?e.promise.then(function(t){t&&f(i,t)}):angular.isFunction(e.then)?e.then(function(t){t&&f(i,t)}):f(i,e))}function p(){var t=i.carouselCollection.position,n=i.carouselCollection.getLastIndex(),s=null;0===t&&angular.isDefined(c.rnCarouselPrev)&&(s=e(c.rnCarouselPrev)(i,{item:i.carouselCollection.cards[0]}),d("before",s)),t===n&&angular.isDefined(c.rnCarouselNext)&&(s=e(c.rnCarouselNext)(i,{item:i.carouselCollection.cards[i.carouselCollection.cards.length-1]}),d("after",s))}function g(t,e){var i={};return i[t]=e,angular.forEach(A,function(n){i["-"+n.toLowerCase()+"-"+t]=e}),i}function m(t){return g("transform","translate("+t+"px,0)")}function x(){y(),v()}function y(){$.css("width","auto"),w=!0;var t=S.children("li");return b=0===t.length?S[0].getBoundingClientRect().width:t[0].getBoundingClientRect().width,$.css("width",b+"px"),b}function v(t){w=!!t||w,0===b&&y(),I=Math.round(i.carouselCollection.getRelativeIndex()*-b),w===!0?S.removeClass("rn-carousel-animate").addClass("rn-carousel-noanimate").css(m(I,!1)):S.removeClass("rn-carousel-noanimate").addClass("rn-carousel-animate").css(m(I,!0)),w=!1}r++;var C="rn-carousel-"+r,I=0,b=0,w=!0,S=n.wrap("<div id='"+C+"' class='rn-carousel-container'></div>"),$=S.parent();a&&(i.fakeArray=a);var B=e(s),M={},z=0;if(c.rnCarouselIndex){var L=e(c.rnCarouselIndex);angular.isFunction(L.assign)?(i.$watch("carouselCollection.index",function(t){L.assign(i.$parent,t)}),z=L(i),i.$parent.$watch(L,function(t){void 0!==t&&i.carouselCollection.goToIndex(t,!0)})):isNaN(c.rnCarouselIndex)||(z=parseInt(c.rnCarouselIndex,10))}angular.isDefined(c.rnCarouselCycle)&&(M.cycle=!0),M.index=z,u&&(M.bufferSize=3,M.buffered=!0),i.carouselCollection=o.create(M),i.$watch("carouselCollection.updated",function(t){t&&v()});var T=!1;i.$watch(B,function(t){i.carouselCollection.setItems(t,T),T=!0,0===b&&y(),v()}),angular.isDefined(c.rnCarouselWatch)&&i.$watch(s,function(t){i.carouselCollection.setItems(t,!1),T=!0,0===b&&y(),v()},!0);var A=["webkit","moz"];if(S[0].addEventListener("webkitTransitionEnd",h,!1),S[0].addEventListener("transitionend",h,!1),window.addEventListener("orientationchange",x),window.addEventListener("resize",x),angular.isDefined(c.rnCarouselIndicator)){var k=t("<div id='"+C+"-indicator'  fn='carouselCollection.goToIndex' index='carouselCollection.index' items='carouselCollection.items' data-rn-carousel-indicators class='rn-carousel-indicator'></div>")(i);$.append(k)}}}}}]).directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<ol ng-show="isShowIndicators()" class="rn-carousel-indicator"><li  ng-click="goToIndex($index, true);" ng-repeat="item in items" ng-class="{active: $index==$parent.index}"></li></ol>',link:function(t){t.goToIndex=function(e,i){t.$parent.carouselCollection.goToIndex(e,i)},t.isShowIndicators=function(){return t.items.length>1}}}}]);